%Copyright (c) <2015> <John T. Foster>

%Permission is hereby granted, free of charge, to any person obtaining a copy
%of this software and associated documentation files (the "Software"), to deal
%in the Software without restriction, including without limitation the rights
%to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
%copies of the Software, and to permit persons to whom the Software is
%furnished to do so, subject to the following conditions:

%The above copyright notice and this permission notice shall be included in
%all copies or substantial portions of the Software.

%THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
%IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
%FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
%AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
%LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
%OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
%THE SOFTWARE.
\usepackage{nameref}
\newcommand*{\currentname}{\@currentlabelname}
\usepackage[T1]{fontenc}
\renewcommand*\familydefault{\sfdefault} %% Only if the base font of the document is to be sans serif

\setbeamertemplate{itemize/enumerate body begin}{\small}
\setbeamertemplate{itemize/enumerate subbody begin}{\scriptsize}
\setbeamertemplate{itemize/enumerate subsubbody begin}{\scriptsize}
\setbeamertemplate{itemize/enumerate subsubsubbody begin}{\tiny}


\usefonttheme{serif}

\DeclareOptionBeamer{dept}{\def\beamer@Cockrell@dept{#1}}    
\ExecuteOptionsBeamer{dept=CockrellSchool}
\ProcessOptionsBeamer

\mode<presentation>

%Requirements
\RequirePackage{tikz}
\graphicspath{{./figs/}}

%The base themes we inherit from
\usetheme[headheight=1.0cm]{boxes}                 
\usecolortheme{default}                 

\definecolor{utorange}{RGB}{191, 87, 0}
\definecolor{sunfishblack}{RGB}{2, 30, 41}
\definecolor{sunfishblue}{RGB}{0, 36, 60}
\definecolor{sunfishyellow}{RGB}{180, 143, 38}
\definecolor{utblack}{RGB}{51, 63, 72}
\definecolor{cffffff}{RGB}{255,255,255}
\definecolor{mrl_red}{RGB}{189,32,49}


% Add a footer progress bar
\setbeamertemplate{footline}{
    \hspace{-0.25cm}
    \setbeamercolor{bgcolor}{fg=mrl_red ,bg=white} 
    \begin{beamercolorbox}[wd=1\paperwidth,,ht=3ex,dp=1.5ex,leftskip=2ex,rightskip=2ex]{bgcolor}%
    \usebeamerfont{author}\textcolor{mrl_red}\insertdate\hfill
            \currentname \hfill
        \insertframenumber{} / \inserttotalframenumber
    \end{beamercolorbox}
}


%The titlebar showing the Dept name and UT-Austin logo
% \pgfdeclareimage[width=0.3\textwidth]{CockrellSchool}{./figs/CockrellSchool}

\addheadbox{section in head/foot}{}
\addtobeamertemplate{footline}{%
  \setlength\unitlength{1ex}%
  \begin{picture}(0,0) 
    % \put{} defines the position of the frame
    \put(1,93.2){\makebox(0,0)[bl]{
    \includegraphics[scale=0.145]{figs/MRL x QEERI Logo-3.pdf}
    }}%
  \end{picture}%
}{}

%\addheadbox{section in head/foot}{\raisebox{0.0em}{\includegraphics[width=1.0\textwidth]{\beamer@Cockrell@dept}}}

%Theme settings
%Title page
%\setbeamerfont{title page}{series=\mdseries}
\setbeamercolor{normal text}{bg=white, fg=black}
\setbeamercolor{title page}{bg=white, fg=black}
\setbeamerfont{title}{series=\bfseries}
\setbeamercolor{title}{fg=mrl_red}
\setbeamerfont{subtitle}{series=\bfseries}
\setbeamercolor{subtitle}{fg=black}
\setbeamerfont{author}{series=\mdseries}
\setbeamercolor{author}{fg=black}
\setbeamercolor{background canvas}{bg=white}
%Color palette
\setbeamercolor{structure}{fg=sunfishyellow}
\setbeamercolor{section in head/foot}{bg=mrl_red, fg=black}
\setbeamercolor*{palette primary}{use=structure,bg=white, fg=black}
\setbeamercolor*{palette secondary}{use=structure,bg=sunfishblack, fg=sunfishyellow}
\setbeamercolor*{palette tertiary}{bg=utorange, fg=sunfishyellow}
\setbeamercolor*{palette quaternary}{bg=sunfishblack, fg=sunfishyellow}
%Frames
\setbeamercolor*{frametitle}{use=structure,fg=black, bg=white}
\setbeamercolor*{framesubtitle}{fg=black}
%Blocks
\setbeamertemplate{blocks}[rounded][shadow=true]
\setbeamercolor*{block title}{fg=black, bg=mrl_red}
%Text
\setbeamercolor{normal text}{bg=white,fg=black}
\setbeamercolor{alerted text}{fg=black}
\setbeamercolor{item projected}{use=item,fg=black,bg=item.fg!35}
\setbeamertemplate{itemize subitem}{{\textendash}}
\setbeamercolor{subitem}{fg=black}
%Remove navigation symbols
\setbeamertemplate{navigation symbols}{}
%Note page settings
\setbeamerfont{note page}{size=\scriptsize}
\setbeamertemplate{note page}{\insertnote\par}

%Setup title page
\defbeamertemplate*{title page}{customized}[1][]{%
  \vspace{1cm}
  \usebeamerfont{title page}\usebeamercolor[fg]{title page}
  \vspace{-0.2cm}
  \rule{11cm}{0.4pt}\par
  \bigskip
  \usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par
  \usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par
  \bigskip
  \usebeamerfont{title page}\usebeamercolor[fg]{title page}
  \rule{11cm}{0.4pt}\par
  {\flushright
  \usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par
  \usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par
  \usebeamerfont{date}\usebeamercolor[fg]{institute}\insertdate\par
  }
}


%Use correct fonts
%\usepackage[default,oldstyle,scale=0.95]{opensans}
%\usepackage[T1]{fontenc}


%Use biber for special bibliogrphay.  The next few lines are all custom hacks to
%make nice footnote citation in beamer.
% \usepackage[hyperref=true,style=verbose,labeldate=true,minnames=2,maxnames=10,maxbibnames=99,backend=biber]{biblatex}
%Use utorange for hyperlinks

% \usepackage[style=authortitle,
%             autocite=footnote,
%             backend=biber,
%             sorting=none,
%           ]{biblatex}
% \addbibresource{example.bib}


\hypersetup{colorlinks=true, allcolors=black, linkcolor=utorange, urlcolor=utorange, citecolor=utorange, filecolor=utorange}



% %\renewcommand*{\labelnamepunct}{\addcolon\addspace}
% \DeclareFieldFormat[article,inbook,incollection,inproceedings,patent,thesis,unpublished]
% {title}{#1\isdot}
% % \renewbibmacro*{cite:short}{%
% %   \printnames{labelname}%
% %   \setunit*{\addspace}%
% %   \printtext[bibhyperlink]{%
% %     \printfield{labelyear}\printfield{extrayear}}}
% \newbibmacro*{cite:title}{%
%   \printtext[bibhyperref]{%
%     \printfield[citetitle]{labeltitle}%
%     \setunit{\space}%
%     \printtext[parens]{\printdate}%
%   }%
% }

% %Remove footnote marks
% \newcommand\footnotenonum[1]{%
%   \begingroup
%   \renewcommand\thefootnote{}\footnote{#1}%
%   \addtocounter{footnote}{-1}%
%   \endgroup
% }

% \makeatletter
% \renewrobustcmd{\blx@mkbibfootnote}[2]{%
%   \iftoggle{blx@footnote}
%     {\blx@warning{Nested notes}%
%      \addspace\mkbibparens{#2}}
%     {\unspace
%      \ifnum\blx@notetype=\tw@
%       \expandafter\@firstoftwo
%      \else
%       \expandafter\@secondoftwo
%      \fi
%       {\csuse{blx@theendnote#1}{\protecting{\blxmkbibnote{end}{#2}}}}
%       {\csuse{footnotenonum#1}{\protecting{\blxmkbibnote{foot}{#2}}}}}}
% \makeatother

% %For footnote citing
\setbeamertemplate{footnote}{% 
%   \parbox[b]{1.0\textwidth}{%
  \tiny
  \parindent 1em 
  \noindent
  \hbox to 1.8 em{\hfil\insertfootnotemark}
  \insertfootnotetext
%   }
} 

\renewcommand\cite{\footcite}
\renewcommand\thefootnote{[\arabic{footnote}]}

%Create lastpage macro
\newcommand{\lastframe}{%
\setbeamercolor{background canvas}{bg=utorange}
\setbeamertemplate{headline}{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=\paperwidth,ht=8.25ex,dp=3.5ex]{utorange}%
  \end{beamercolorbox}%
  }%
}
\begin{frame}
    \vspace{1.5cm}
    \begin{center}
        \includegraphics[width=1.48\textwidth]{CockrellSchool}
    \end{center}
\end{frame}
}

\newcommand{\titleframe}{\frame{\maketitle}}

\mode<all>
